{% extends "base.html" %}

{% block title %}Contabilidad Empresas - Panel de Administración{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='contabilidad_empresas.css') }}">
{% endblock %}

{% block content %}

<div class="container" style="margin-top: 120px;">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">Contabilidad mensual</h3>
    <a href="{{ url_for('nueva_factura') }}" class="btn btn-custom">Nueva factura</a>
  </div>

  <table class="table table-bordered table-hover text-white align-middle">
    <thead>
      <tr>
        <th>Empresa</th>
        <th>Mes</th>
        <th>Monto</th>
        <th>Fecha Factura</th>
        <th>Estado</th>
        <th>Fecha Pago</th>
        <th>Método</th>
        <th>Observaciones</th>
        <th class="text-center">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for factura in facturas %}
      <tr>
        <td>{{ factura.empresa.nombre }}</td>
        <td>{{ factura.mes }}</td>
        <td>${{ "{:,.0f}".format(factura.monto_facturado) }}</td>
        <td>{{ factura.fecha_factura.strftime('%Y-%m-%d') }}</td>
        <td>
          {% if factura.pagado %}
            <span class="badge bg-success">Pagado</span>
          {% else %}
            <span class="badge bg-warning text-dark">Pendiente</span>
          {% endif %}
        </td>
        <td>
          {% if factura.fecha_pago %}
            {{ factura.fecha_pago.strftime('%Y-%m-%d') }}
          {% else %}
            -
          {% endif %}
        </td>
        <td>{{ factura.metodo_pago or '-' }}</td>
        <td>{{ factura.observaciones or '-' }}</td>
        <td class="text-center">
          <div class="d-inline-flex gap-2">
            <a href="{{ url_for('editar_factura', id=factura.id) }}" class="btn btn-sm btn-warning">Editar</a>
            <form method="POST" action="{{ url_for('eliminar_factura', id=factura.id) }}" onsubmit="return confirm('¿Seguro que quieres eliminar esta factura?')">
              <button type="submit" class="btn btn-sm btn-danger">Eliminar</button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
